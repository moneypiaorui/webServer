"use strict";(globalThis.webpackChunkinfinity_hitab_client=globalThis.webpackChunkinfinity_hitab_client||[]).push([[2994,1259],{73337:(t,i,e)=>{e.d(i,{Kn:()=>u,fN:()=>r,k$:()=>h,nI:()=>p});var a=e(74003),l=e(63477),n=e(80661),o=e.n(n),s=e(17904);const r=async t=>{try{if("location"===t)throw new Error("location error");const i=await s.hj.get(`${a.Hg}weather/city`,{location:t,lang:a.sM?"zh":"en"},{_delay:200,_single:!0});if(0===i.code&&i.data.list.length>0)return[null,i.data.list.map((t=>({...t,cid:t.id})))];throw i}catch(t){return["catch error"]}},d=t=>(t.updateTime=o()(t.updateTime).valueOf(),t.daily=t.daily.map((t=>{const i=(0,l.sG)(t.fxDate);return{...t,fxDateStr:a.sM?i.format("M月D ddd"):i.format("MMM D, ddd"),dateStr:i.format("ddd"),weekStr:a.sM?i.format("D日"):i.format("D"),tempMax:t.tempMax+"°",tempMin:t.tempMin+"°"}})),t),c=t=>(t.updateTime=o()(t.updateTime).valueOf(),t.hourly=t.hourly.map((t=>({...t,fxTimeStr:o()(t.fxTime).format("HH:mm"),temp:t.temp+"°",windScale:a.sM?t.windScale+"级":"级"+t.windScale,windSpeed:t.windSpeed+"km/h",humidity:t.humidity+"%",precip:t.precip+"mm"}))),t),p=async t=>{try{if("location"===t)throw new Error("location error");const i=await s.hj.get(`${a.Hg}weather/daily`,{location:t,lang:a.sM?"zh":"en"},{_delay:0});if(0===i.code)return[null,d(i.data)];throw i}catch(t){return["catch error"]}},u=async t=>{try{if("location"===t)throw new Error("location error");const i=await s.hj.get(`${a.Hg}weather/hourly`,{location:t,lang:a.sM?"zh":"en"},{_delay:0});if(0===i.code)return[null,c(i.data)];throw i}catch(t){return["catch error"]}},h=async()=>{try{const t=await s.hj.get(`${a.Hg}weather/location`,{},{_delay:0});if(0===t.code)return[null,t.data];throw t}catch(t){return["catch error"]}}},22854:(t,i,e)=>{e.d(i,{C:()=>n});var a=e(29445),l=e(57268);const n=(t,i,e)=>{const n=(0,a.iH)(t);i.onChangeState=t=>{n.value={...t}};const o=(0,l.Fl)((()=>e?e[n.value.size]:null));return{propsState:n,HomeComp:o}}},84138:(t,i,e)=>{e.d(i,{i7:()=>p,iE:()=>s,m_:()=>r,x4:()=>c,zI:()=>n});var a=e(74003),l=e(73337);const n="location",o={sunny:[[100],[150]],cloudy:[[101,104],[151,154]],rain:[[300,399]],snow:[[400,499]],haze:[[500,515]]};function s(t){const i=Number(t);let e="cloudy";for(const t in o){if(o[t].some((a=>{if(1===a.length){if(i===a[0])return e=t,!0}else if(2===a.length&&i>=a[0]&&i<=a[0])return e=t,!0})))break}return e}const r=t=>`${a.c1}/weather-icon/${t}.png`,d=a.sM?"116.40528,39.90498":"-73.96900,40.77899";function c(t){return new Promise((i=>{let e=!1;const a=t=>{e=!0,i(t)};setTimeout((()=>{e||(0,l.k$)().then((i=>{let[e,l]=i;a(null===e?l:t?"":d)}))}),0),setTimeout((()=>{a(t?"":d)}),5e3)}))}const p=(t,i)=>`weather-bg-${i||"cloudy"}-${t}`},22994:(t,i,e)=>{e.r(i),e.d(i,{mountHome:()=>vt,widgetApp:()=>ht});var a=e(29445),l=e(68398),n=e(57268),o=e(41259),s=e(94209),r=e(84138);const d={class:"mr-[20px] text-[28px] text-color-t1 icon-m:mr-[16px] icon-s:mr-[8px]"},c={class:"flex h-full flex-col justify-between text-color-t2"},p={class:"flex items-center"},u={class:"break-all line-clamp-1"},h=["src"],v={class:"font-ali-55 text-[12px]"},y={class:"mr-[4px]"},m=(0,n.aZ)({__name:"weather-home-small",props:{id:null,state:null},setup(t){const i=t,e=(0,n.Fl)((()=>{var t,e;return null===(t=i.state)||void 0===t||null===(e=t.weathers)||void 0===e?void 0:e.now})),l=(0,n.Fl)((()=>{var t;return null===(t=i.state)||void 0===t?void 0:t.activeTempRange})),o=(0,n.Fl)((()=>{var t;return null===(t=i.state)||void 0===t?void 0:t.activeCityLongName}));return(t,i)=>{var m,g,w,x;return(0,n.wg)(),(0,n.iD)("section",{class:(0,s.normalizeClass)([[(0,a.SU)(r.i7)("card",null===(m=(0,a.SU)(e))||void 0===m?void 0:m.type)],"weather-home-small flex h-full items-center px-[24px] py-[20px] icon-m:py-[12px] icon-m:px-[16px] icon-s:p-[8px]"])},[(0,n._)("div",d,(0,s.toDisplayString)(null===(g=(0,a.SU)(e))||void 0===g?void 0:g.temp),1),(0,n._)("div",c,[(0,n._)("div",p,[(0,n._)("span",u,(0,s.toDisplayString)((0,a.SU)(o)),1),(0,n._)("img",{class:"ml-[2px] h-[24px] w-[24px]",draggable:"false",src:(0,a.SU)(r.m_)(null===(w=(0,a.SU)(e))||void 0===w?void 0:w.icon)},null,8,h)]),(0,n._)("div",v,[(0,n._)("span",y,(0,s.toDisplayString)(null===(x=(0,a.SU)(e))||void 0===x?void 0:x.text),1),(0,n._)("span",null,(0,s.toDisplayString)((0,a.SU)(l)),1)])])],2)}}}),g={class:"flex justify-between p-[8px] !pb-0 icon-m:p-[12px] icon-s:p-[12px]"},w={class:"flex flex-col text-color-t2"},x={class:"text-[48px] leading-none text-color-t1"},S={class:"mt-[12px] break-all line-clamp-1"},f=["src"],C={class:"p-[8px] !pt-0 font-ali-55 text-[12px] text-color-t2 icon-m:p-[12px] icon-s:p-[12px]"},_={class:"mr-[4px]"},D={class:"card flex h-[60px] flex-shrink-0 items-center justify-around rounded-[16px] bg-color-white text-[12px] text-color-t2 icon-m:h-[60px] icon-m:rounded-[12px] icon-s:h-[48px] icon-s:rounded-[12px] dark:bg-opacity-20"},U={class:"card-item"},I={class:"font-ali-55 text-color-t3"},W={class:"card-item"},b={class:"font-ali-55 text-color-t3"},M={class:"card-item icon-s:!hidden"},k={class:"font-ali-55 text-color-t3"},T={class:"card-item"},H={class:"font-ali-55 text-color-t3"},q={class:"font-ali-55 text-color-t3"},z=(0,n.aZ)({__name:"weather-home-medium",props:{id:null,state:null},setup(t){const i=t,e=(0,n.Fl)((()=>{var t,e;return null===(t=i.state)||void 0===t||null===(e=t.weathers)||void 0===e?void 0:e.now})),l=(0,n.Fl)((()=>{var t;return null===(t=i.state)||void 0===t?void 0:t.activeTempRange})),o=(0,n.Fl)((()=>{var t;return null===(t=i.state)||void 0===t?void 0:t.activeCityLongName}));return(t,i)=>{var d,c,p,u,h,v,y,m,z,$,j;return(0,n.wg)(),(0,n.iD)("section",{class:(0,s.normalizeClass)([[(0,a.SU)(r.i7)("card",null===(d=(0,a.SU)(e))||void 0===d?void 0:d.type)],"weather-home-medium flex h-full flex-col justify-between p-[12px] icon-m:p-[8px] icon-s:p-[4px]"])},[(0,n._)("div",g,[(0,n._)("div",w,[(0,n._)("span",x,(0,s.toDisplayString)(null===(c=(0,a.SU)(e))||void 0===c?void 0:c.temp),1),(0,n._)("span",S,(0,s.toDisplayString)((0,a.SU)(o)),1)]),(0,n._)("img",{class:"ml-[2px] h-[24px] w-[24px]",draggable:"false",src:(0,a.SU)(r.m_)(null===(p=(0,a.SU)(e))||void 0===p?void 0:p.icon)},null,8,f)]),(0,n._)("div",C,[(0,n._)("span",_,(0,s.toDisplayString)(null===(u=(0,a.SU)(e))||void 0===u?void 0:u.text),1),(0,n._)("span",null,(0,s.toDisplayString)((0,a.SU)(l)),1)]),(0,n._)("div",D,[(0,n._)("div",U,[(0,n._)("span",null,(0,s.toDisplayString)(null===(h=(0,a.SU)(e))||void 0===h?void 0:h.humidity),1),(0,n._)("span",I,(0,s.toDisplayString)("湿度"),1)]),(0,n._)("div",W,[(0,n._)("span",null,(0,s.toDisplayString)(null===(v=(0,a.SU)(e))||void 0===v?void 0:v.windScale),1),(0,n._)("span",b,(0,s.toDisplayString)(null===(y=(0,a.SU)(e))||void 0===y?void 0:y.windDir),1)]),(0,n._)("div",M,[(0,n._)("span",null,(0,s.toDisplayString)(null===(m=(0,a.SU)(e))||void 0===m?void 0:m.windSpeed),1),(0,n._)("span",k,(0,s.toDisplayString)("风速"),1)]),(0,n._)("div",T,["rain"===(null===(z=(0,a.SU)(e))||void 0===z?void 0:z.type)?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[(0,n._)("span",null,(0,s.toDisplayString)(null===($=(0,a.SU)(e))||void 0===$?void 0:$.precip),1),(0,n._)("span",H,(0,s.toDisplayString)("降水量"),1)],64)):((0,n.wg)(),(0,n.iD)(n.HY,{key:1},[(0,n._)("span",null,(0,s.toDisplayString)(null===(j=(0,a.SU)(e))||void 0===j?void 0:j.pressure),1),(0,n._)("span",q,(0,s.toDisplayString)("百帕"),1)],64))])])],2)}}});var $=e(76911);const j=(0,$.Z)(z,[["__scopeId","data-v-1e604080"]]),L={class:"weather-home-large flex h-full"},F={class:"flex h-full w-[200px] flex-col justify-between bg-color-b4 p-[20px] icon-m:w-[172px] icon-s:w-[152px]"},N={class:"text-[48px] leading-none text-color-t1"},R={class:""},A={class:"flex items-center"},Z={class:"text-color-t2 line-clamp-2"},E=["src"],Y={class:"font-ali-55 text-[12px] text-color-t2"},P={class:"mr-[4px]"},K={class:"card flex h-[60px] flex-shrink-0 items-center justify-evenly rounded-[8px] bg-color-white bg-opacity-80 text-[12px] text-color-t2 dark:bg-opacity-20"},O={class:"card-item"},G={class:"font-ali-55 text-color-t3"},B={class:"card-item"},Q={class:"font-ali-55 text-color-t3"},J={class:"card-item"},V={class:"font-ali-55 text-color-t3"},X={class:"card-item"},tt={class:"font-ali-55 text-color-t3"},it={class:"font-ali-55 text-color-t3"},et={class:"day mt-[46px] flex items-center justify-around text-[12px] icon-m:mt-[28px] icon-s:mt-[28px]"},at={key:0,class:"flex flex-col items-center"},lt=["src"],nt={class:"text-color-t2"},ot={class:"font-ali-55 text-color-t3"},st=(0,n.aZ)({__name:"weather-home-large",props:{id:null,state:null},setup(t){const i=t,e=(0,n.Fl)((()=>{var t,e;return null===(t=i.state)||void 0===t||null===(e=t.weathers)||void 0===e?void 0:e.now})),l=(0,n.Fl)((()=>{var t,e;return null===(t=i.state)||void 0===t||null===(e=t.weathers)||void 0===e?void 0:e.day})),o=(0,n.Fl)((()=>{var t;return null===(t=i.state)||void 0===t?void 0:t.activeTempRange})),d=(0,n.Fl)((()=>{var t;return null===(t=i.state)||void 0===t?void 0:t.activeCityLongName}));return(t,i)=>{var c,p,u,h,v,y,m,g,w,x,S,f;return(0,n.wg)(),(0,n.iD)("section",L,[(0,n._)("div",F,[(0,n._)("span",N,(0,s.toDisplayString)(null===(c=(0,a.SU)(e))||void 0===c?void 0:c.temp),1),(0,n._)("div",R,[(0,n._)("div",A,[(0,n._)("span",Z,(0,s.toDisplayString)((0,a.SU)(d)),1),(0,n._)("img",{class:"ml-[4px] h-[32px] w-[32px]",draggable:"false",src:(0,a.SU)(r.m_)(null===(p=(0,a.SU)(e))||void 0===p?void 0:p.icon)},null,8,E)]),(0,n._)("div",Y,[(0,n._)("span",P,(0,s.toDisplayString)(null===(u=(0,a.SU)(e))||void 0===u?void 0:u.text),1),(0,n._)("span",null,(0,s.toDisplayString)((0,a.SU)(o)),1)])])]),(0,n._)("div",{class:(0,s.normalizeClass)([[(0,a.SU)(r.i7)("card",null===(h=(0,a.SU)(e))||void 0===h?void 0:h.type)],"h-full grow p-[24px] icon-m:p-[18px] icon-s:p-[16px]"])},[(0,n._)("div",K,[(0,n._)("div",O,[(0,n._)("span",null,(0,s.toDisplayString)(null===(v=(0,a.SU)(e))||void 0===v?void 0:v.humidity),1),(0,n._)("span",G,(0,s.toDisplayString)("湿度"),1)]),(0,n._)("div",B,[(0,n._)("span",null,(0,s.toDisplayString)(null===(y=(0,a.SU)(e))||void 0===y?void 0:y.windScale),1),(0,n._)("span",Q,(0,s.toDisplayString)(null===(m=(0,a.SU)(e))||void 0===m?void 0:m.windDir),1)]),(0,n._)("div",J,[(0,n._)("span",null,(0,s.toDisplayString)(null===(g=(0,a.SU)(e))||void 0===g?void 0:g.windSpeed),1),(0,n._)("span",V,(0,s.toDisplayString)("风速"),1)]),(0,n._)("div",X,["rain"===(null===(w=(0,a.SU)(e))||void 0===w?void 0:w.type)?((0,n.wg)(),(0,n.iD)(n.HY,{key:0},[(0,n._)("span",null,(0,s.toDisplayString)(null===(x=(0,a.SU)(e))||void 0===x?void 0:x.precip),1),(0,n._)("span",tt,(0,s.toDisplayString)("降水量"),1)],64)):((0,n.wg)(),(0,n.iD)(n.HY,{key:1},[(0,n._)("span",null,(0,s.toDisplayString)(null===(S=(0,a.SU)(e))||void 0===S?void 0:S.pressure),1),(0,n._)("span",it,(0,s.toDisplayString)("百帕"),1)],64))])]),(0,n._)("div",et,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(null===(f=(0,a.SU)(l))||void 0===f?void 0:f.list,((t,i)=>((0,n.wg)(),(0,n.iD)(n.HY,{key:t.fxDate},[i<5?((0,n.wg)(),(0,n.iD)("div",at,[(0,n._)("img",{class:"h-[28px] w-[28px]",draggable:"false",src:(0,a.SU)(r.m_)(t.iconDay)},null,8,lt),(0,n._)("span",nt,(0,s.toDisplayString)(t.weekStr),1),(0,n._)("span",ot,(0,s.toDisplayString)(t.dateStr),1)])):(0,n.kq)("",!0)],64)))),128))])],2)])}}}),rt=(0,$.Z)(st,[["__scopeId","data-v-33a484b2"]]);var dt=e(22854);const ct=(0,n.aZ)({__name:"widget-weather-home",props:{size:null,widgetData:null,id:null},setup(t){const i=t,e={s:m,m:j,l:rt},{HomeComp:l,propsState:s}=(0,dt.C)(i,ht.value,e),d=(0,o.useWeatherStore)(),c=(0,a.iH)(),p=async()=>{var t,i,e,a;const l=null===(t=s.value)||void 0===t?void 0:t.id,n=(null==s||null===(i=s.value)||void 0===i||null===(e=i.widgetData)||void 0===e?void 0:e.cityId)??r.zI;await d.reqLocation(!0),await d.reqWeather(null===(a=d.getCity(n))||void 0===a?void 0:a.cid),c.value={cid:n,wid:l,weathers:d.getWeather(n),activeTempRange:d.getTempRange(n),activeCityLongName:d.getCityLongName(n)}};(0,n.bv)((()=>{p()})),(0,n.YP)((()=>s.value),(()=>p())),(0,n.bv)((async()=>{setInterval((()=>{var t,i,e;const a=null===(t=d.getCity(null==s||null===(i=s.value)||void 0===i||null===(e=i.widgetData)||void 0===e?void 0:e.cityId))||void 0===t?void 0:t.cid;d.reqWeather(a)}),3e5)}));const u=()=>{var t,e,a,l;d.setModal(!0,null===(t=s.value)||void 0===t?void 0:t.id);const n=(null==s||null===(e=s.value)||void 0===e||null===(a=e.widgetData)||void 0===a?void 0:a.cityId)??r.zI;d.setActive(n==(null===(l=d.locationCity)||void 0===l?void 0:l.cid)?r.zI:n,i.id),setTimeout((()=>{d.setSearchModal(!1)}),200)};return(t,e)=>((0,n.wg)(),(0,n.iD)("section",{class:"widget-weather-home h-full w-full cursor-pointer",onClick:u},[((0,n.wg)(),(0,n.j4)((0,n.LL)((0,a.SU)(l)),{id:i.id,state:c.value},null,8,["id","state"]))]))}});var pt=e(96755),ut=e(75008);const ht=(0,a.iH)(null),vt=(t,i)=>{const e=(0,l.createApp)(ct,i);return(0,ut.f)(e),ht.value=e,e.use(pt.M),e.mount(t),ht.value}},41259:(t,i,e)=>{e.r(i),e.d(i,{useWeatherStore:()=>h,widgetInfo:()=>u});var a=e(84522),l=e(10435),n=e(84138),o=e(73337),s=e(34906),r=e(94119),d=e(24581),c=e(12793);const p={cityId:n.zI},u=(0,d.E0)(d.Rm.timerMark),h=(0,l.Q_)(a.BU.weather,{syncStorage:{watch:["weathers","locationCity","addedCity","activeCityId"]},syncCloud:{watch:["addedCity","activeCityId"]},state:()=>({searchModalShow:!1,modalShow:!1,weathers:{},locationCity:{cid:"",name:"",adm1:"",adm2:"",expired:0},addedCity:[],activeCityId:n.zI,activeWidgetId:"",widgetData:p}),getters:{allCids(){return this.addedCity.map((t=>t.cid)).concat(this.locationCity.cid)},activeCid(){return this.activeCityId===n.zI?this.locationCity.cid:this.activeCityId},getCityWeather:t=>i=>t.weathers[i],activeCityWeather(){return this.getCityWeather(this.activeCid)},activeNow(){var t;return null===(t=this.activeCityWeather)||void 0===t?void 0:t.now},activeDay(){var t;return null===(t=this.activeCityWeather)||void 0===t?void 0:t.day},activeHour(){var t;return null===(t=this.activeCityWeather)||void 0===t?void 0:t.hour},activeTempRange(){var t,i;const e=null===(t=this.activeCityWeather)||void 0===t||null===(i=t.day)||void 0===i?void 0:i.list;if(e){const t=e[0].tempMin;return`${e[0].tempMax} ~ ${t}`}return""},activeCity(){return this.activeCityId===n.zI?this.locationCity:this.addedCity.find((t=>t.cid===this.activeCityId))},addedCityIds(){return this.addedCity.map((t=>t.cid))},activeCityLongName(){return this.activeCity?this.activeCity.adm2===this.activeCity.name?this.activeCity.name:this.activeCity.adm2+" · "+this.activeCity.name:""}},actions:{saveWidgetData(t,i){const e=(0,c.i)(),a=e.getIconData(t);e.saveIcon({...a,id:t,widgetData:i})},getCity(t){return t==n.zI?this.locationCity:this.addedCity.find((i=>i.cid===t))||this.locationCity},getCityLongName(t){const i=this.getCity(t);return i?i.adm2===i.name?i.name:i.adm2+" · "+i.name:""},getWeather(t){const i=this.getCity(t).cid;return this.getCityWeather(i)},getTempRange(t){var i,e;const a=null===(i=this.getWeather(t))||void 0===i||null===(e=i.day)||void 0===e?void 0:e.list;if(a){const t=a[0].tempMin;return`${a[0].tempMax} ~ ${t}`}return""},async setSearchModal(t){this.searchModalShow=t,t&&(await this.reqLocation(!1),this.reqAllWeather())},async setModal(t,i){i&&(this.activeWidgetId=i),r.G.setStatus(d.Rm.weather,t),t?this.reqAllWeather():this.searchModalShow=!1,this.modalShow=t},setActive(t,i){this.activeCityId=t,t&&(i||this.activeWidgetId)&&(this.widgetData={cityId:t},this.saveWidgetData(i||(i||this.activeWidgetId),this.widgetData))},async reqHourWeather(t){const[i,e]=await(0,o.Kn)(t);if(i)return;const a={list:e.hourly,expired:(0,s.Z)(e.expiredTime,Date.now()+12e4,Date.now()+36e5),updateTime:e.updateTime},l=e.hourly[0],r={updateTime:e.updateTime,type:(0,n.iE)(l.icon),temp:l.temp,icon:l.icon,text:l.text,windDir:l.windDir,windScale:l.windScale,windSpeed:l.windSpeed,humidity:l.humidity,precip:l.precip,pressure:l.pressure};this.weathers[t]={...this.weathers[t],hour:a,now:r},this.weathers={...this.weathers}},clearWeathers(){Object.keys(this.weathers).forEach((t=>{this.allCids.includes(t)||delete this.weathers[t]}))},async reqDayWeather(t){const[i,e]=await(0,o.nI)(t);if(i)return;const a={list:e.daily,expired:(0,s.Z)(e.expiredTime,Date.now()+12e4,Date.now()+288e5),updateTime:e.updateTime};this.weathers[t]={...this.weathers[t],day:a},this.weathers={...this.weathers}},async reqWeather(t){var i;t===n.zI&&(t=null===(i=this.getCity(t))||void 0===i?void 0:i.cid);if(!t)return;const e=this.getCityWeather(t),a=[];e?((!e.day||e.day.expired<Date.now())&&a.push(this.reqDayWeather(t)),(!e.hour||e.hour.expired<Date.now())&&a.push(this.reqHourWeather(t))):a.push(this.reqDayWeather(t),this.reqHourWeather(t)),await Promise.all(a)},async reqAllWeather(){await Promise.all([this.reqWeather(this.locationCity.cid),...this.addedCity.map((t=>this.reqWeather(t.cid)))])},async reqLocation(t){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{if(!i){if(this.locationCity.expired>Date.now())return;if(t&&this.locationCity.cid)return}const e=await(0,n.x4)(!!this.locationCity.cid);if(!e)return;const[a,l]=await(0,o.fN)(e);if(a||!l)return;this.locationCity={cid:l[0].id,name:l[0].name,adm1:l[0].adm1,adm2:l[0].adm2,expired:Date.now()+2e3}}catch(t){}},async addCity(t){const i=this.addedCity.findIndex((i=>i.cid===t.cid));i>-1&&this.addedCity.splice(i,1),this.addedCity.unshift(t),this.addedCity.length>4&&(this.addedCity.length=4),this.addedCity=[...this.addedCity],await this.reqAllWeather(),this.clearWeathers()},removeCity(t){const i=this.addedCity.findIndex((i=>i.cid===t));i>-1&&(this.addedCity.splice(i,1),this.addedCity=[...this.addedCity]),this.clearWeathers()}}})}}]);